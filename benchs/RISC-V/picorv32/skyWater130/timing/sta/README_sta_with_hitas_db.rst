README_sta.rst
=================

Marie-Minerve Louerat

Update 23 February, 2024
Update 23 September, 2024 : generation of a timing path (transistor level) for simualtion with ngspice
---------------------------------------------------------------------------------------------------

coriolis-2.x/src/alliance-check-toolkit/benchs/RISC-V/picorv32/skyWater130/timing/sta/README_sta.rst

Goal
--------
This directory contains the files to analyze the timing response of:
 picorv32 generated by openroad on the native netlist of skywater130
by static timing analysis with Hitas
to be compared with ngspice simulation

Note
----
Transistor model files have to be tuned, compared to those used by ngspice, as they require :
  * full path of the file in a hirerachical description
  * level = 14 for analysis BSIM4 model, if the reference simulator (parameters provided by the foundry)
    is ngspice
    or level = 54 for hspice
  * for simulation with ngspice of a generated netlist of a slected timing path by HiTas,
    at transistor level,
    models of transistors have to instantiate the model directly MWWW (not the .SUBCKT wrapper).


Subdirectories
---------------
hitas:  contains the tcl commands to launch HiTas
techno: contains the required updated files of the PDK transistor models 
        to be compliant with HiTas in SkyWater130

Environment
-----------
Launch:
  bash
  source ./hitas/avt_env.sh

Runing HiTas
----------------
example:
1. Building the timing database
   ./hitas/db_ng.tcl

creates picorv32.dtx and other files

(see picorv32.rep)

2. Report critical paths
   ./hitas/report_picorv32.tcl

provides the picorv32.paths file that shows the 2 paths of the design.

Generating the transistor level netlist of a selected timing path and performing ngspice simulation
---------------------------------------------------------------------------------------------------
When the timing data base is generated (.dtx file), you may run:

    .paths_select_simu.tcl

it uses 
    picorv32.dtx

it generates:
    picorv32.spi     : transistor-level netlist of the select timing path
                                           compliant with ngspice
    cmd_picorv32.spi : input file for ngspice, including 
                                           sky130_fd_sc_hd__inv_1_3_ext.spi netlist model 
                                           and commands to compute gate delays
                                           compliant with ngspice

it automatically launches the command:
    ngspice -b cmd_picorv32_ext.spi

which generates:
    cmd_picorv32_ext.out : ngspice simulation result
                                           with delays estimation
    picorv32.selectedPath: HiTas estimation of the same timing path
                                           that can be compared, in the case of the
                                           chain of 3 inverters to:   
                                           picorv32.paths




